!function(e,n){"function"==typeof define&&define.amd?define([],n):"object"==typeof module&&module.exports?(module.exports=n(),module.exports.default=module.exports):e.smokemachine=e.SmokeMachine=n()}("undefined"!=typeof self?self:this,function(){var u=[0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,1,0,0,0,0,0,0,0,0,0,0,3,5,5,7,4,4,1,1,0,1,0,0,0,0,0,1,0,0,17,27,41,52,56,34,23,15,11,4,9,5,1,0,0,0,0,0,0,1,45,63,57,45,78,66,52,41,34,37,23,20,0,1,0,0,0,0,1,43,62,66,64,67,115,112,114,56,58,47,33,18,12,10,0,0,0,0,39,50,63,76,87,107,105,112,128,104,69,64,29,18,21,15,0,0,0,7,42,52,85,91,103,126,153,128,124,82,57,52,52,24,1,0,0,0,2,17,41,67,84,100,122,136,159,127,78,69,60,50,47,25,7,1,0,0,0,34,33,66,82,113,138,149,168,175,82,142,133,70,62,41,25,6,0,0,0,18,39,55,113,111,137,141,139,141,128,102,130,90,96,65,37,0,0,0,2,15,27,71,104,129,129,158,140,154,146,150,131,92,100,67,26,3,0,0,0,0,46,73,104,124,145,135,122,107,120,122,101,98,96,35,38,7,2,0,0,0,50,58,91,124,127,139,118,121,177,156,88,90,88,28,43,3,0,0,0,0,30,62,68,91,83,117,89,139,139,99,105,77,32,1,1,0,0,0,0,0,16,21,8,45,101,125,118,87,110,86,64,39,0,0,0,0,0,0,0,0,0,1,28,79,79,117,122,88,84,54,46,11,0,0,0,0,0,0,0,0,0,1,0,6,55,61,68,71,30,16,0,0,0,0,0,0,0,0,0,0,0,0,0,0,14,23,25,20,12,5,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,12,9,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,4,2,2,0,0,0,0,0,0,0,0],l=20,s=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;function i(e,n){return e+Math.random()*(n-e)}function d(e,n,t){(t=t||{}).lifetime;var a={x:e,y:n,vx:i(t.minVx||-.04,t.maxVx||.04),startvy:i(t.minVy||-.4,t.maxVy||-.1),scale:i(t.minScale||0,t.maxScale||.5),lifetime:i(t.minLifetime||2e3,t.maxLifetime||8e3),age:0};return a.finalScale=i(t.minScale||25+a.scale,t.maxScale||30+a.scale),a.vy=a.startvy,a}return function(t,e){var a=function(e){e=e||[24,46.8,48.2];for(var n=document.createElement("canvas"),t=n.getContext("2d"),a=t.createImageData(l,l),i=a.data,o=0;o<i.length;o+=4)i[o]=e[0],i[o+1]=e[1],i[o+2]=e[2],i[o+3]=u[o/4];return n.width=l,n.height=l,t.putImageData(a,0,0),n}(e),o=[],i=function(){};function r(n){t.clearRect(0,0,t.canvas.width,t.canvas.height),o.forEach(function(e){!function(e,n){e.x+=e.vx*n,e.y+=e.vy*n;var t=Math.sqrt(e.age/e.lifetime);e.vy=(1-t)*e.startvy,e.age+=n,e.scale=t*e.finalScale}(e,n)}),o=o.filter(function(e){return e.age<e.lifetime}),i(n,o),o.forEach(function(e){!function(e,n,t){t.globalAlpha=(1-Math.abs(1-2*e.age/e.lifetime))/8;var a=e.scale*l/2,i=e.x-a,o=i+2*a,r=e.y-a,c=r+2*a;t.drawImage(n,i,r,o-i,c-r)}(e,a,t)})}var c=!1,f=performance.now();function m(e){if(c){var n=e-f;f=e,r(n),s(m)}}function n(e,n,t,a){if((t=t||10)<1)return Math.random()<=t&&o.push(d(e,n,a));for(var i=0;i<t;i++)o.push(d(e,n,a))}return{step:function(e){e=e||16,console.log(e),r(e)},start:function(){c=!0,f=performance.now(),s(m)},setPreDrawCallback:function(e){i=e},stop:function(){c=!1},addsmoke:n,addSmoke:n}}});