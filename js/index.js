$(function(){var e,n,t,a,i=!0;$("#audio_btn").on("click",function(){var e=(i=!i)?"../images/audio_open.png":"../images/audio_close.png";$(this).css("background-image","url("+e+")").toggleClass("open")}),e=$(".process-bar"),n=Math.floor($(".process").width()),t=0,a=setInterval(function(){t<=n?(t+=5,e.css("width",t)):($(".loading-page").hide(),$(".start-page").show(),clearInterval(a))},100),$("#start_btn").on("click",function(){$(".map-page").fadeIn().siblings().fadeOut()});var p=null,s="",l=[];function o(){var i=$(".map-page .area").eq(p),s=i.attr("data-scan-count")||0,o=u(0,weaponData.length),c=weaponData[o],r=u(0,2),d="";setTimeout(function(){if(2==s)d="<p>很遗憾,<br />本区域已搜空</p>",$(".pop-container .content .result").html(d),$(".pop-container, .mask").fadeIn();else if(1==r||1==s){var e=3e3;if("parts"===c.type)l.push(c);else{switch(c.id){case 1:m([255,255,255]),g();break;case 2:m([3,149,149]),g();break;case 3:e=800,$(".mask").html('<img src="./images/guang.gif" />'),g();break;case 4:e=1500,(a=document.createElement("canvas")).style.position="absolute",a.style.zIndex=101,a.style.top=0,a.style.left=0,a.width=innerWidth,a.height=innerHeight,document.body.appendChild(a),$(a).let_it_snow({image:"./images/4.png",windPower:3,speed:1,count:10,size:10}),g();break;default:e=2e3,function(){for(var e="",n=0;n<12;n++)e+='<img src="./images/quan.png" class="quan bounce quan'+n+'" />';$(".mask").css("background-image",'url("./images/mask-bg.png")').append(e)}()}$(".mask").fadeIn()}if(weaponData.splice(o,1),d="<img src="+c.src+' class="weapon'+c.id+'" />',5==l.length){d='<h5 class="tit">恭喜你集齐<span>五件套</span></h5><div class="list">';for(var n=0,t=l.length;n<t;n++)d+='<div class="item"><img src="'+l[n].src+'" /></div>';d+="</div>",$(".pop-container .content .result").addClass("success"),$(".pop-container .continue-btn, .pop-container .back-btn").hide(),$(".pop-container .start-btn").css("display","flex")}i.attr("data-scan-count",2).addClass("active"),$(".pop-container .content .result").html(d),setTimeout(function(){$(".mask").css("background-image","none").empty(),$("canvas").remove(),$(".mask").empty(),$(".pop-container, .mask").fadeIn()},e)}else d="<p>很遗憾,<br />本区域未扫描出任何物品</p>",i.attr("data-scan-count",1),$(".pop-container .content .result").html(d),$(".pop-container, .mask").fadeIn();var a},1500)}function u(e,n){return Math.floor(Math.random()*(n-e))+e}function m(e){var n=document.createElement("canvas");n.style.position="absolute",n.style.zIndex=101,n.style.top=0,n.style.left=0;var t=n.getContext("2d");n.width=innerWidth,n.height=innerHeight,document.body.appendChild(n);var a=smokemachine(t,e);a.start(),a.step(10),a.setPreDrawCallback(function(e){a.addSmoke(innerWidth/2,innerHeight,.8),n.width=innerWidth,n.height=innerHeight})}function g(){document.getElementById("bgaudio");(new function(){var a=!1;this.startPlay=function(e){var n=document.getElementById(e),t=function(){a&&!n.paused||(n.play(),a=!0,document.removeEventListener("touchstart",t,!1))};document.addEventListener("touchstart",t,!1),document.addEventListener("WeixinJSBridgeReady",t,!1),document.addEventListener("YixinJSBridgeReady",t,!1),"micromessenger"!=window.navigator.userAgent.toLowerCase().match(/MicroMessenger/i)&&(console.info("no-weixin"),t())}}).startPlay("weapon-audio")}$(".map-page .area").on("click",function(){if(!$(this).hasClass("active")){var e=$(this).data("scanCount")||0;p=$(this).data("index"),s=$(this).data("name"),$(this).attr("data-scanCount",e++),$(".map-page").fadeOut(),$(".scan-page .title").text(s),$(".scan-page").fadeIn("normal",function(){o()})}}),$(".back-btn").on("click",function(){$(".pop-container, .scan-page, .mask").fadeOut(),$(".map-page").fadeIn()}),$(".continue-btn").on("click",function(){$(".mask").fadeOut(),$(".pop-container").fadeOut("normal",function(){o()})}),$(".start-btn").on("click",function(){$(".pop-container .title").text("组装成功"),$(".pop-container .content .result").removeClass("success").html('<img src="./images/qiang.png" class="qiang" />'),$(this).hide().next().css("display","flex")}),$(".reset-btn").on("click",function(){window.location.reload()})});
