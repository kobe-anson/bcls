$(function(){var a,n,t,e,s=!0;$("#audio_btn").on("click",function(){var a=(s=!s)?"../images/audio_open.png":"../images/audio_close.png";$(this).css("background-image","url("+a+")").toggleClass("open")}),a=$(".process-bar"),n=Math.floor($(".process").width()),t=0,e=setInterval(function(){t<=n?(t+=5,a.css("width",t)):($(".loading-page").hide(),$(".start-page").show(),clearInterval(e))},100),$("#start_btn").on("click",function(){$(".map-page").fadeIn().siblings().fadeOut()});var l=null,i="",d=[];function o(){var s=$(".map-page .area").eq(l),i=s.attr("data-scan-count")||0,o=u(0,weaponData.length),c=weaponData[o],r=u(0,2),p="";setTimeout(function(){if(2==i)p="<p>很遗憾,<br />本区域已搜空</p>",$(".pop-container .content .result").html(p),$(".pop-container, .mask").fadeIn();else if(1==r||1==i){var a=3e3;if("parts"===c.type)d.push(c);else{switch(c.id){case 1:g([255,255,255]),m();break;case 2:g([3,149,149]),m();break;case 3:a=800,$(".mask").html('<img src="./images/guang.gif" />'),m();break;case 4:a=1500,(e=document.createElement("canvas")).style.position="absolute",e.style.zIndex=101,e.style.top=0,e.style.left=0,e.width=innerWidth,e.height=innerHeight,document.body.appendChild(e),$(e).let_it_snow({image:"./images/4.png",windPower:3,speed:1,count:10,size:10}),m();break;default:a=2e3,function(){for(var a="",n=0;n<12;n++)a+='<img src="./images/quan.png" class="quan bounce quan'+n+'" />';$(".mask").css("background-image",'url("./images/mask-bg.png")').append(a)}()}$(".mask").fadeIn()}if(weaponData.splice(o,1),p="<img src="+c.src+' class="weapon'+c.id+'" />',5==d.length){p='<h5 class="tit">恭喜你集齐<span>五件套</span></h5><div class="list">';for(var n=0,t=d.length;n<t;n++)p+='<div class="item"><img src="'+d[n].src+'" /></div>';p+="</div>",$(".pop-container .content .result").addClass("success"),$(".pop-container .continue-btn, .pop-container .back-btn").hide(),$(".pop-container .start-btn").css("display","flex")}s.attr("data-scan-count",2).addClass("active"),$(".pop-container .content .result").html(p),setTimeout(function(){$(".mask").css("background-image","none").empty(),$("canvas").remove(),$(".mask").empty(),$(".pop-container, .mask").fadeIn()},a)}else p="<p>很遗憾,<br />本区域未扫描出任何物品</p>",s.attr("data-scan-count",1),$(".pop-container .content .result").html(p),$(".pop-container, .mask").fadeIn();var e},1500)}function u(a,n){return Math.floor(Math.random()*(n-a))+a}function g(a){var n=document.createElement("canvas");n.style.position="absolute",n.style.zIndex=101,n.style.top=0,n.style.left=0;var t=n.getContext("2d");n.width=innerWidth,n.height=innerHeight,document.body.appendChild(n);var e=smokemachine(t,a);e.start(),e.step(10),e.setPreDrawCallback(function(a){e.addSmoke(innerWidth/2,innerHeight,.8),n.width=innerWidth,n.height=innerHeight})}function m(){$("#weapon-audio").get(0).play()}$(".map-page .area").on("click",function(){if(!$(this).hasClass("active")){var a=$(this).data("scanCount")||0;l=$(this).data("index"),i=$(this).data("name"),$(this).attr("data-scanCount",a++),$(".map-page").fadeOut(),$(".scan-page .title").text(i),$(".scan-page").fadeIn("normal",function(){o()})}}),$(".back-btn").on("click",function(){$(".pop-container, .scan-page, .mask").fadeOut(),$(".map-page").fadeIn()}),$(".continue-btn").on("click",function(){$(".mask").fadeOut(),$(".pop-container").fadeOut("normal",function(){o()})}),$(".start-btn").on("click",function(){$(".pop-container .title").text("组装成功"),$(".pop-container .content .result").removeClass("success").html('<img src="./images/qiang.png" class="qiang" />'),$(this).hide().next().css("display","flex")}),$(".reset-btn").on("click",function(){window.location.reload()})});